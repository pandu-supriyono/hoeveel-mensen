<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>✨</text></svg>"></link>
  <title>Hoeveel mensen?</title>
  <meta name="description" content="Schat hoeveel mensen moeite kunnen hebben met toegang tot de digitale wereld vanwege verschillende kenmerken. Gebruik deze informatie om problemen in je eigen digitale dienst te verminderen en om bij te dragen aan een inclusieve toekomst.">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="phase-banner">
    <div class="container">
      Deze website is onder ontwikkeling en de gegevens kunnen incompleet of verouderd zijn.
    </div>
  </div>
  <div class="hero">
    <div class="container">
      <h1>
        Hoeveel mensen?
      </h1>

      <p>
        Schat hoeveel mensen moeite kunnen hebben met toegang tot de digitale wereld vanwege verschillende kenmerken. Gebruik deze informatie om problemen in je eigen digitale dienst te verminderen en om bij te dragen aan een inclusieve toekomst.
      </p>

      <form id="calculate-form">
        <label for="number-of-users">
          Aantal gebruikers
        </label>
        <input type="text" id="number-of-users" name="number-of-users">
        <button type="submit">Berekenen</button>
      </form>
    </div>
  </div>

  <main>
    <div class="container">
      <div id="results"></div>
    </div>
  </main>

  <footer>
    <div class="container">
      Door <a href="https://supriyono.nl">Pandu Supriyono</a>. Geïnspireerd door <a href="https://design.education.gov.uk/tools/how-many-users">het werk van het Britse ministerie van Onderwijs</a> en de <a href="https://digitalservicebund.github.io/wie-viele-menschen/">Digitale Dienst van de Bondsrepubliek Duitsland</a>. Zie <a href="https://github.com/pandu-supriyono/hoeveel-mensen">de Broncode van deze website</a>
    </div>
  </footer>

  <script>
    const statsJSONString = '[{"measure":"Laaggecijferd","percent":16,"source":"https://www.rekenkamer.nl/publicaties/rapporten/2016/04/20/aanpak-van-laaggeletterdheid","notes":"Volwassenen","type":"c"},{"measure":"Laaggeletterd","percent":15,"source":"https://www.rekenkamer.nl/publicaties/rapporten/2016/04/20/aanpak-van-laaggeletterdheid","notes":"Volwassenen","type":"c"},{"measure":"Psychische aandoening","percent":25,"source":"https://www.trimbos.nl/kennis/cijfers/psychische-gezondheid-ggz/","notes":"Volwassenen","type":"a"},{"measure":"Motorische beperking","percent":8,"source":"https://handicap.nl/wat-is-een-motorische-beperking/"},{"measure":"Doof of slechthorend","percent":9,"source":"https://www.gebarencentrum.nl/vragen%20over%20NGT"},{"measure":"Blind of slechtziend","percent":2,"source":"https://bartimeus.nl/slechtziend-en-blind"},{"measure":"ADHD","percent":3,"source":"https://www.vzinfo.nl/adhd/totale-bevolking#:~:text=In%202021%20waren%20er%20naar,bekend%20bij%20de%20huisarts%20(jaarprevalentie","notes":"Volwassenen","type":"a"},{"measure":"Dementie","percent":0.017,"source":"https://www.alzheimer-nederland.nl/factsheet-cijfers-en-feiten-over-dementie","type":"a"},{"measure":"Verstandelijke beperking","percent":2.3,"source":"https://files.cargocollective.com/c1108496/Digitaal---De-Fabeltjes-krant.pdf","type":"a"},{"measure":"Enige beperking","percent":11,"source":"https://www.rijksoverheid.nl/onderwerpen/rechten-van-mensen-met-een-handicap#:~:text=In%20Nederland%20hebben%202%20miljoen,in%20andere%20wetten%20en%20regels.","type":"a"},{"measure":"B1 Nederlands of hoger","percent":80,"source":"https://www.communicatierijk.nl/vakkennis/inclusieve-communicatie/begrijpelijke-communicatie","type":"b"},{"measure":"Dyslexie","percent":4,"source":"https://balansdigitaal.nl/kennisbank/ontwikkelingsproblemen/welke-ontwikkelingsproblemen-zijn-er/wat-is-dyslexie#:~:text=In%20Nederland%20heeft%20ongeveer%204,een%20kind%20met%20dyslexie%20zit.","type":"a"},{"measure":"Dyscalculie","percent":4,"source":"https://www.impulsenwoortblind.nl/dyslexie-dyscalculie/dyscalculie#:~:text=Dyscalculie%20komt%20ongeveer%20net%20zo,minder%20goed%20herkend%20dan%20dyslexie.","type":"a"},{"measure":"Autisme","percent":2,"source":"https://www.autisme.nl/over-autisme/wat-is-autisme/#:~:text=Ongeveer%201%25%20tot%202%25%20van,zorgverleners%20%E2%80%93%20is%20vele%20malen%20groter.","type":"a"},{"measure":"Kleurenblindheid (mannen)","percent":8,"source":"https://www.oogvereniging.nl/oogklachten/kleurenblindheid/#:~:text=Kleurenblindheid%20bij%20mannen,-Rood%2Dgroenkleurenblindheid%20komt&text=Ongeveer%201%20op%20de%2012,op%20het%20X%2Dchromosoom%20liggen.","type":"a"},{"measure":"Kleurenblindheid (vrouwen)","percent":0.004,"source":"https://www.oogvereniging.nl/oogklachten/kleurenblindheid/#:~:text=Kleurenblindheid%20bij%20mannen,-Rood%2Dgroenkleurenblindheid%20komt&text=Ongeveer%201%20op%20de%2012,op%20het%20X%2Dchromosoom%20liggen.","type":"a"},{"measure":"Gebruikt Nederlands Gebarentaal","percent":0.3,"source":"https://www.researchgate.net/profile/Corrie-Tijsseling/publication/338274451_10_In_Pursuit_of_Legal_Recognition_of_the_Sign_Language_of_the_Netherlands/links/5e27581c4585150ee7783277/10-In-Pursuit-of-Legal-Recognition-of-the-Sign-Language-of-the-Netherlands.pdf","type":"b"},{"measure":"Internationale kenniswerkers","percent":2.1,"source":"https://files.cargocollective.com/c1108496/Digitaal---De-Fabeltjes-krant.pdf","type":"c"}]'

    const formatter = Intl.NumberFormat('nl-NL');

    const stats = JSON.parse(statsJSONString);

    const searchParams = new URLSearchParams(window.location.search);

    const input = document.querySelector('#number-of-users');

    const form = document.querySelector('#calculate-form');

    const types = {
      a: 'Beperkingen en aandoeningen',
      b: 'Taal',
      c: 'Sociaaleconomische factoren'
    }

    const conditions = [
      [(x) => !x, 'Je moet invullen hoeveel gebruikers je gaat verwachten'],
      [(x) => Number.isNaN(Number(x)), 'Je moet een nummer invullen die hoger is dan 0'],
      [(x) => !Number.isNaN(Number(x)) && !Number(x) > 0, 'Je moet een nummer invullen die hoger is dan 0']
    ]

    if (searchParams.get('number-of-users')) {
      input.value = searchParams.get('number-of-users');

      const passesCondition = conditions.every(([validateFn]) => {
        if (validateFn(searchParams.get('number-of-users'))) {
          return false;
        }

        return true;
      });

      if (!passesCondition) {
        window.history.replaceState(null, null, '?');
      } else {
        performSearch(Number(searchParams.get('number-of-users')));
      }
    };

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);

      const numberOfUsers = formData.get('number-of-users');

      let isError = false;

      conditions.every(([validateFn, errorMessage]) => {
        if (validateFn(numberOfUsers)) {
          attachErrorMessage(errorMessage);

          isError = true;
          return false;
        }

        removeErrorMessage();

        isError = false;
        return true;
      })

      if (isError) {
        return;
      }

      searchParams.set("number-of-users", numberOfUsers);

      window.history.replaceState(null, null, `?${searchParams.toString()}`);

      performSearch(numberOfUsers);
    });

    function removeErrorMessage() {
      const existingError = document.querySelector('#error');

      if (existingError) {
        existingError.remove();

        input.removeAttribute('aria-describedby');
      }
    }

    function attachErrorMessage(errorMessage) {
      const existingError = document.querySelector('#error');

      if (existingError) {
        existingError.textContent = errorMessage;

        return;
      }

      const errorElement = document.createElement('span');

      errorElement.setAttribute('id', 'error');

      errorElement.setAttribute('aria-live', 'polite');

      errorElement.classList.add('error-message');

      errorElement.textContent = errorMessage;

      input.setAttribute('aria-describedby', 'error');

      input.after(errorElement);
    }

    function performSearch(amount) {
      const results = document.querySelector('#results');

      results.innerHTML = '';

      const resultHeading = document.createElement('h2');

      const resultLead = document.createElement('p');

      resultHeading.textContent = `Resultaat voor ${formatter.format(amount)} gebruiker(s)`;

      resultLead.textContent = `Deze cijfers zijn gebaseerd op gegevens uit verschillende bronnen. Een persoon kan meerdere kenmerken hebben, waardoor het aantal niet op ${amount} uitkomt.`

      results.append(resultHeading);

      results.append(resultLead);

      Object.entries(types).forEach(([type, label]) => {
        const items = stats.filter((item) => item.type === type);

        const table = document.createElement('table');

        const thead = document.createElement('thead');

        const trHead = document.createElement('tr');

        const th = ['Categorie', 'Aantal gebruikers', 'Bron'].map((headingItem) => {
          const heading = document.createElement('th');

          heading.textContent = headingItem;

          return heading;
        });

        trHead.append(...th);

        thead.append(trHead);

        const tbody = document.createElement('tbody');

        items.sort((a, b) => {
          const measureA = a.measure.toLowerCase();
          const measureB = b.measure.toLowerCase();

          if (measureA < measureB) {
            return -1;
          }

          if (measureA > measureB) {
            return 1;
          }

          return 0;
        }).forEach((item) => {
          const tr = document.createElement('tr');

          const category = document.createElement('th');
          category.setAttribute('scope', 'row');
          const number = document.createElement('td');
          const source = document.createElement('td');
          const sourceLink = document.createElement('a');

          category.textContent = item.measure;
          number.textContent = formatter.format(Math.ceil((item.percent * amount) / 100));
          sourceLink.textContent = 'Bron';
          sourceLink.setAttribute('href', item.source);
          source.append(sourceLink);

          tr.append(category, number, source);

          tbody.append(tr);
        });

        table.append(thead);

        table.append(tbody);

        const heading = document.createElement('h3');

        heading.textContent = label;

        results.append(heading);

        results.append(table);
      });
    }
  </script>
</body>
</html>
